!function(){"use strict";var e=window.wp.element;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},t.apply(this,arguments)}const{useState:n,useEffect:l,useRef:r}=wp.element,{Popover:a,Button:s}=wp.components;var i=i=>{const[c,o]=n(!1),[u,m]=n(!1),g=r(null);function d(e){m(!1)}function h(e){u||o((e=>!e)),m(void 0===e)}return l((()=>(document.addEventListener("click",d),()=>{document.removeEventListener("click",d)})),[]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s,{ref:g,isLink:!0,onClick:h},"Details"),c&&(0,e.createElement)(a,t({className:"wsu-gutenberg-accessibility-panel__details-view",headerTitle:i.label,onClose:h,position:"bottom left"},WSUWP_DATA.wpVersion.includes("6.1")?{anchor:i.anchor.current}:{getAnchorRect:()=>{const e=i.anchor.current?.getBoundingClientRect()||null;return e?(e.x=e.right-e.width-e.width/2-25-8,e.y=e.y-e.height-10,e):null}}),(0,e.createElement)("h4",{className:"wsu-gutenberg-accessibility-panel__details-heading"},i.label),(0,e.createElement)("div",{className:"wsu-gutenberg-accessibility-panel__details-content"},i.children)))};const{ExternalLink:c}=wp.components,{useRef:o}=wp.element,u=t=>(0,e.createElement)(e.Fragment,null,t.logs.length>0?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__report-table"},(0,e.createElement)("tbody",null,t.logs.map(((t,n)=>{const l=o(null);return(0,e.createElement)("tr",{ref:l,key:`rr-${n}`},(0,e.createElement)("td",null,t.message),(0,e.createElement)("td",null,(0,e.createElement)(i,{label:t.detailsViewLabel,anchor:l},(0,e.createElement)(t.detailsView,null))))}))))):(0,e.createElement)("p",{className:"wsu-gutenberg-accessibility-panel__report-empty-message"},t.emptyMessage));var m=t=>{const{report:n,isLoading:l,error:r,permalink:a}=t,s=[{label:"Errors",icon:"dismiss",logs:n.errors},{label:"Alerts",icon:"warning",logs:n.alerts},{label:"Warnings",icon:"flag",logs:n.warnings}];return(0,e.createElement)(e.Fragment,null,l||r?r?(0,e.createElement)("p",null,r):(0,e.createElement)("p",null,"loading..."):(0,e.createElement)(e.Fragment,null,s.map((t=>(0,e.createElement)("div",{key:`section-${t.label}`,className:"wsu-gutenberg-accessibility-panel__section"},(0,e.createElement)("h3",{className:"wsu-gutenberg-accessibility-panel__section-heading"},(0,e.createElement)("span",{className:`dashicon dashicons dashicons-${t.icon}`})," ",t.label),(0,e.createElement)(u,{logs:t.logs,emptyMessage:`0 ${t.label.toLowerCase()} to display.`}))))),(0,e.createElement)(c,{className:"wsu-gutenberg-accessibility-panel__wave-link",href:"https://wave.webaim.org/report#/"+a},"Review on WAVE"))};const{PluginDocumentSettingPanel:g}=wp.editPost;var d=t=>(0,e.createElement)(g,{name:"wsu-accessibility",title:"Accessibility",className:"wsu-gutenberg-accessibility-panel"},(0,e.createElement)(m,t));const{useState:h,useEffect:p,useRef:b}=wp.element;wp.hooks.addFilter("wsu.Accessibility","wsuwp/accessibility-checker",((t,n)=>{const l=[];if(Array.from(n.querySelectorAll("a")).forEach((e=>{const t=e.getAttribute("href");null!==t&&""!==t.trim()&&"#"!==t.trim()&&"http://"!==t.trim()&&"https://"!==t.trim()||l.push(e)})),l.length>0){const n=l.length>1?"s":"";t.errors.push({message:`${l.length} link${n} with missing or invalid href${n}`,detailsViewLabel:"Links with missing or invalid hrefs",detailsView:function(t){return(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__details-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,"Link Text"),(0,e.createElement)("th",null,"Href"))),(0,e.createElement)("tbody",null,t.map(((t,n)=>(0,e.createElement)("tr",{key:"link-"+n},(0,e.createElement)("td",null,t.textContent),(0,e.createElement)("td",null,t.getAttribute("href")))))))}.bind(void 0,l)})}return t})),wp.hooks.addFilter("wsu.Accessibility","wsuwp/accessibility-checker",((t,n)=>{const l=[],r=[],a=[];function s(t,n){return(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__details-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,"Preview"),(0,e.createElement)("th",null,"Filename"),n&&(0,e.createElement)("th",null,"Alt Text"))),(0,e.createElement)("tbody",null,t.map(((t,l)=>{const r=t.getAttribute("src")?.split("/").pop(),a=t.alt?.trim();return(0,e.createElement)("tr",{key:"image-"+l},(0,e.createElement)("td",null,(0,e.createElement)("img",{src:t.getAttribute("src")})),(0,e.createElement)("td",null,r),n&&(0,e.createElement)("td",null,a))}))))}if(Array.from(n.querySelectorAll("img")).forEach((e=>{const t=e.closest("a"),n=e.alt.trim();n||t?t&&-1!==t.tabIndex&&!n?r.push(e):t&&n&&a.push(e):l.push(e)})),l.length>0){const e=l.length>1?"s":"";t.warnings.push({message:`${l.length} image${e} missing alt text`,detailsViewLabel:"Images missing alt text",detailsView:s.bind(void 0,l,!1)})}if(r.length>0){const e=r.length>1?"s":"";t.errors.push({message:`${r.length} linked image${e} missing alt text`,detailsViewLabel:"Linked images missing alt text",detailsView:s.bind(void 0,r,!1)})}if(a.length>0){const e=a.length>1?"s":"";t.warnings.push({message:`${a.length} image${e} where alt text should be the destination`,detailsViewLabel:"Images where alt text should be the destination",detailsView:s.bind(void 0,a,!0)})}return t})),wp.hooks.addFilter("wsu.Accessibility","wsuwp/accessibility-checker",((t,n)=>{let l=null===n.querySelector("h1")?1:0;const r=Array.from(n.querySelectorAll("h1, h2, h3, h4, h5, h6"));let a=!1;const s=r.map((e=>{const t=parseInt(e.tagName[1]),n=!(t>l+1),r=a?"minus":n?"yes-alt":"dismiss";return l=t,a=!0===a||!n,{icon:r,tag:e.tagName,content:e.textContent}}));return a&&t.alerts.push({message:"Incorrect heading order",detailsViewLabel:"Incorrect heading order",detailsView:function(t){return(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__details-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,"Valid"),(0,e.createElement)("th",null,"Level"),(0,e.createElement)("th",null,"Content"))),(0,e.createElement)("tbody",null,t.map(((t,n)=>(0,e.createElement)("tr",{key:"heading-"+n},(0,e.createElement)("td",null,(0,e.createElement)("span",{className:`dashicon dashicons dashicons-${t.icon}`})),(0,e.createElement)("td",null,t.tag),(0,e.createElement)("td",null,t.content))))))}.bind(void 0,s)}),t})),wp.hooks.addFilter("wsu.Accessibility","wsuwp/accessibility-checker",((t,n)=>{const l=[];if(Array.from(n.querySelectorAll("p")).forEach((e=>{const t=e.textContent;if(""!==t.trim()&&(Array.from(e.querySelectorAll("strong, b")).forEach((t=>{(function(e,t){let n=t.parentNode;for(;n;){if(n===e)return!0;n=n.parentNode}return!1})(e,t)&&t.parentNode.removeChild(t)})),""===e.textContent.trim())){const e=t.length>75?"â€¦":"";l.push(t.substring(0,75).trim()+e)}})),l.length>0){const n=l.length>1?"s":"",r=1===l.length?"s":"";t.warnings.push({message:`${l.length} paragraph${n} contain${r} only bold text`,detailsViewLabel:"Paragraphs with only bolded text",detailsView:function(t){return(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__details-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,"Paragraph Text"))),(0,e.createElement)("tbody",null,t.map(((t,n)=>(0,e.createElement)("tr",{key:"para-"+n},(0,e.createElement)("td",null,t))))))}.bind(void 0,l)})}return t}));const w=wp.plugins.registerPlugin,{applyFilters:E}=wp.hooks,{useSelect:y,useDispatch:f}=wp.data,v=()=>{const t={errors:[],alerts:[],warnings:[],data:{}},{editPost:n}=f("core/editor"),{postId:l,editedPostContent:r,permalink:a,isSaving:s}=y((e=>{const t=e("core/editor");return{postId:t.getCurrentPostId(),editedPostContent:t.getEditedPostContent(),permalink:t.getPermalink(),isSaving:t.isSavingPost()||t.isAutosavingPost()}})),{html:i,isLoading:c,error:o}=function(e,t){const[n,l]=h({html:null,isLoading:!1,error:null}),r=b(null);return p((()=>{try{return l({html:null,isLoading:!0,error:null}),r.current?.abort(),"undefined"!=typeof AbortController&&(r.current=new AbortController),(async()=>{const n=await fetch(WSUWP_DATA.siteUrl+"/wp-json/wsu-gutenberg-accessibility/v1/parse-gutenberg-content",{method:"POST",body:new URLSearchParams({postId:e,content:t}),signal:r.current?.signal}),a=await n.json();n.ok?l({html:a.html,isLoading:!1,error:null}):l({html:null,isLoading:!1,error:`${a.code} | ${a.message} ${n.status} (${n.statusText})`})})(),()=>{r.current?.abort()}}catch(e){l({html:null,isLoading:!1,error:e.message})}}),[e,t]),n}(l,r);if(null!==i){const e=(new DOMParser).parseFromString(i,"text/html");E("wsu.Accessibility",t,e),setTimeout((()=>{n({meta:{wsuwp_accessibility_report:JSON.stringify(t)}})}),0)}return(0,e.createElement)(d,{report:t,isLoading:c,error:o,permalink:a})};w("wsu-plugin-accessibility",{render:()=>null!==wp.data.select("core/editor").getCurrentPostLastRevisionId()&&(0,e.createElement)(v,null),icon:""})}();
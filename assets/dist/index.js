!function(){"use strict";var e=window.wp.element;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}const{useState:n,useEffect:r,useRef:s}=wp.element,{Popover:l,Button:a}=wp.components;var i=i=>{const[o,c]=n(!1),[u,m]=n(!1),g=s(null);function p(e){m(!1)}function d(e){u||c((e=>!e)),m(void 0===e)}return r((()=>(document.addEventListener("click",p),()=>{document.removeEventListener("click",p)})),[]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a,{ref:g,isLink:!0,onClick:d},"Details"),o&&(0,e.createElement)(l,t({className:"wsu-gutenberg-accessibility-panel__details-view",onClose:d},WSUWP_ACCESSIBILITY_PLUGIN_DATA.wpVersion.startsWith("6.")?{focusOnMount:!0,placement:"left-start",offset:12,anchor:g.current.closest(".wsu-gutenberg-accessibility-panel__report-table-row")}:{position:"bottom left",getAnchorRect:()=>{const e=g.current.closest(".wsu-gutenberg-accessibility-panel__report-table-row")?.getBoundingClientRect()||null;return e?(e.x=e.right-e.width-e.width/2-25-8,e.y=e.y-e.height-10,e):null}}),i.children))};const{ExternalLink:o}=wp.components,c=t=>(0,e.createElement)(e.Fragment,null,t.logs.length>0?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"wsu-gutenberg-accessibility-panel__report-table"},(0,e.createElement)("tbody",null,t.logs.map(((n,r)=>(0,e.createElement)("tr",{key:`${t.type}-${r}`,className:"wsu-gutenberg-accessibility-panel__report-table-row"},(0,e.createElement)("td",null,n.message),(0,e.createElement)("td",null,n.detailsHtml&&(0,e.createElement)(i,null,(0,e.createElement)("div",{dangerouslySetInnerHTML:{__html:n.detailsHtml}}))))))))):(0,e.createElement)("p",{className:"wsu-gutenberg-accessibility-panel__report-empty-message"},t.emptyMessage));var u=t=>{const{report:n,isLoading:r,error:s,permalink:l}=t,a=[{label:"Errors",description:(0,e.createElement)("p",null,"These items ",(0,e.createElement)("strong",null,"MUST")," be fixed."),icon:"dismiss",logs:n.errors.items},{label:"Alerts",description:(0,e.createElement)("p",null,"These items ",(0,e.createElement)("strong",null,"SHOULD")," be fixed."),icon:"warning",logs:n.alerts.items},{label:"Warnings",description:(0,e.createElement)("p",null,"These items ",(0,e.createElement)("strong",null,"MAY")," need fixing. A manual check is needed."),icon:"flag",logs:n.warnings.items}];return(0,e.createElement)(e.Fragment,null,r||s?s?(0,e.createElement)("p",null,"ðŸ’¥ ",s):(0,e.createElement)("p",null,"loading..."):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,"Learn about the items checked by the"," ",(0,e.createElement)("a",{href:"https://web.wsu.edu/web-training/plugin-training/wsuwp-gutenberg-accessibility/#accessibility-panel"},"Accessibility & Usability Panel")),a.map((t=>(0,e.createElement)("div",{key:`section-${t.label}`,className:"wsu-gutenberg-accessibility-panel__section"},(0,e.createElement)("h3",{className:"wsu-gutenberg-accessibility-panel__section-heading"},(0,e.createElement)("span",{className:`dashicon dashicons dashicons-${t.icon}`})," ",t.label),t.description,(0,e.createElement)(c,{type:t.label,logs:t.logs,emptyMessage:`âœ… 0 ${t.label.toLowerCase()} to display.`}))))),(0,e.createElement)("p",null,"Review your webpage in WAVE for other accessibility errors and alerts not caught by our Accessibility & Usability Panel."),(0,e.createElement)(o,{className:"wsu-gutenberg-accessibility-panel__wave-link",href:"https://wave.webaim.org/report#/"+l},"Review on WAVE"))};const{PluginDocumentSettingPanel:m}=wp.editPost;var g=t=>(0,e.createElement)(m,{name:"wsu-accessibility",title:"Accessibility & Usability",className:"wsu-gutenberg-accessibility-panel"},t.children);const{useState:p,useEffect:d,useRef:b}=wp.element;const{useEffect:w,useRef:h,useReducer:y}=wp.element,E={data:null,isLoading:!1,error:null};function f(e,t){switch(t.type){case"LOADING":return{...E,isLoading:!0};case"SUCCESS":return{...E,data:t.data};case"ERROR":return{...E,error:t.error};default:return e}}var S=function(e,t,n){const[r,s]=y(f,E),l=h();return w((()=>("undefined"!=typeof AbortController&&(l.current=new AbortController),(async()=>{try{s({type:"LOADING"});const n=await fetch(e,{...t,signal:l.current?.signal});if(!n.ok)throw new Error(`${n.status} - ${n.statusText}`);const r=await n.json();s({type:"SUCCESS",data:r})}catch(e){"AbortError"!==e.name&&s({type:"ERROR",error:e.message})}})(),()=>{l.current?.abort()})),n=n||[e]),r};const L=wp.plugins.registerPlugin,{useEffect:v,useRef:A,useState:_}=wp.element,{useSelect:P}=wp.data,C=()=>{const[t,n]=_((()=>({errors:{items:[]},alerts:{items:[]},warnings:{items:[]}}))),r=A(null),{postTitle:s,postId:l,editedPostContent:a,permalink:i,isSaving:o}=P((e=>{const t=e("core/editor");return{postTitle:t.getEditedPostAttribute("title"),postId:t.getCurrentPostId(),editedPostContent:t.getEditedPostContent(),permalink:t.getPermalink(),isSaving:t.isSavingPost()||t.isAutosavingPost()}})),{html:c,isLoading:u,error:m}=function(e,t){const[n,r]=p({html:null,isLoading:!1,error:null}),s=b(null);return d((()=>{try{return r({html:null,isLoading:!0,error:null}),s.current?.abort(),"undefined"!=typeof AbortController&&(s.current=new AbortController),(async()=>{const n=await fetch(WSUWP_ACCESSIBILITY_PLUGIN_DATA.siteUrl+"/wp-json/wsu-gutenberg-accessibility/v1/parse-gutenberg-content",{method:"POST",body:new URLSearchParams({postId:e,content:t}),signal:s.current?.signal}),l=await n.json();n.ok?r({html:l.html,isLoading:!1,error:null}):r({html:null,isLoading:!1,error:`${l.code} | ${l.message} ${n.status} (${n.statusText})`})})(),()=>{s.current?.abort()}}catch(e){r({html:null,isLoading:!1,error:e.message})}}),[e,t]),n}(l,a);return v((()=>{o&&(r.current?.abort(),"undefined"!=typeof AbortController&&(r.current=new AbortController),fetch(WSUWP_ACCESSIBILITY_PLUGIN_DATA.siteUrl+"/wp-json/wsu-gutenberg-accessibility/v1/update-accessibility-report",{method:"POST",body:new URLSearchParams({postId:l,report:JSON.stringify(t)}),signal:r.current?.signal}))}),[o]),(0,e.createElement)(g,null,u||m||!c?u||m||c?m?(0,e.createElement)("p",null,"ðŸ’¥ ",m):u?(0,e.createElement)("p",null,"loading..."):"":(0,e.createElement)("p",null,"No HTML to Review"):(0,e.createElement)(T,{html:c,postTitle:s,permalink:i,report:t,setReport:n}))};function T(t){const{html:n,report:r,setReport:s,permalink:l,postTitle:a}=t,{data:i,isLoading:o,error:c}=S("https://api.web.wsu.edu/accessibility-checker/v1/get-report",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a,html:n})},[n,a]);return v((()=>{i&&!c&&s(i)}),[i]),(0,e.createElement)(u,{report:r,permalink:l,isLoading:o,error:c})}L("wsu-plugin-accessibility",{render:()=>null!==wp.data.select("core/editor").getCurrentPostLastRevisionId()&&(0,e.createElement)(C,null),icon:""})}();